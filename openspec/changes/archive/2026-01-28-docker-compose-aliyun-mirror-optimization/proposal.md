# Docker Compose 镜像源与容器配置优化

## 背景

项目当前使用 Docker Compose 构建系统进行容器编排。用户需要部署多个容器镜像，目前仅支持单一的镜像源选择。

阿里云 ACR 个人版提供了稳定可靠的中国大陆镜像加速服务，对于国内用户能够显著提升镜像拉取速度和部署效率。

## 问题

当前系统存在以下限制：

1. **镜像源单一**：不支持阿里云 ACR 个人版镜像仓库的镜像选择
2. **多容器场景支持不足**：无法同时配置多个镜像容器（如主应用容器和数据库容器）
3. **用户支持渠道缺失**：当用户遇到镜像拉取或部署问题时，缺乏明确的引导和支持机制

具体需求镜像包括：
- `registry.cn-hangzhou.aliyuncs.com/hagicode/hagicode:latest`（应用容器）
- `registry.cn-hangzhou.aliyuncs.com/hagicode/bitnami_postgresql:16`（数据库容器）

## 解决方案

### 1. 扩展镜像源支持

添加阿里云 ACR 个人版作为可选镜像源：

```yaml
# 镜像源配置示例
aliyun_acr:
  region: cn-hangzhou
  namespace: hagicode
```

### 2. 实现多容器镜像配置

支持在单一部署中配置多个容器镜像：

- **应用容器**：允许用户配置主应用镜像地址
- **数据库容器**：支持 PostgreSQL 等依赖服务的镜像配置
- **镜像版本管理**：支持标签选择（如 `:latest`、`:16`）

### 3. 添加用户支持引导

在镜像选择界面添加用户帮助组件：

**展示位置**：镜像选择器旁边

**内容要点**：
- 明确的"遇到问题？"提示文案
- 用户群加入引导（二维码或链接）
- 常见问题快速入口
- 技术支持联系方式

### 4. 配置界面优化

改进 Docker Compose 配置界面：
- 添加镜像源类型选择（Docker Hub / 阿里云 ACR）
- 提供镜像地址验证功能
- 支持镜像标签的版本选择

## 影响

### 技术影响

- **架构变更**：需要扩展镜像源配置系统，增加阿里云 ACR 适配器
- **配置复杂度**：多容器配置需要更清晰的 UI 布局和状态管理
- **验证逻辑**：需要添加镜像地址格式验证和连通性检查

### 用户体验提升

- **部署速度**：国内用户镜像拉取速度显著提升
- **配置便利性**：一站式配置应用和数据库镜像，无需手动编辑 YAML
- **问题解决效率**：明确的用户支持渠道减少排查时间

### 兼容性

- 保持对现有 Docker Hub 镜像源的完全兼容
- 向后兼容现有配置文件格式
- 不影响已有部署流程

## 相关文件

- `src/lib/docker-compose/types.ts` - 类型定义
- `src/lib/docker-compose/defaultConfig.ts` - 默认配置
- `src/lib/docker-compose/generator.ts` - YAML 生成器
- `src/components/docker-compose/ConfigForm.tsx` - 配置表单
- `src/i18n/` - 国际化文件